---
# Traefik configuration for homeserver
deployment:
  replicas: 1

# Environment variables
env:
  - name: K8S_DASHBOARD_TOKEN
    valueFrom:
      secretKeyRef:
        name: k8s-dashboard-token
        key: K8S_DASHBOARD_TOKEN

experimental:
  plugins:
    environmentheader:
      moduleName: github.com/portofrotterdam/environmentheader
      version: v0.1.4

# Service configuration - LoadBalancer with MetalLB
service:
  enabled: true
  type: LoadBalancer
  loadBalancerIP: 10.11.12.12
  annotations:
    metallb.universe.tf/address-pool: homeserver-pool

# Remove host network configuration - using LoadBalancer instead
# hostNetwork: false (default)
# dnsPolicy: ClusterFirst (default)

# Dashboard configuration
dashboard:
  enabled: true

# Resource limits
resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

# Container security context - no special capabilities needed with LoadBalancer
securityContext:
  runAsNonRoot: true
  runAsUser: 65532
  runAsGroup: 65532
  capabilities:
    drop: [ALL]

# Pod security context for plugin storage
podSecurityContext:
  fsGroup: 65532

# Logging
logs:
  general:
    level: INFO
  access:
    enabled: true

# Metrics
metrics:
  prometheus:
    enabled: false

# TLS configuration
tls:
  options:
    default:
      minVersion: VersionTLS12
      cipherSuites:
        - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
        - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
        - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305

# Port configuration - entrypoints for LoadBalancer
ports:
  traefik:
    port: 8080
    expose:
      default: true
    exposedPort: 8080
  web:
    port: 80
    redirections:
      entryPoint:
        to: websecure
        scheme: https
        permanent: true
  websecure:
    port: 443
    tls:
      enabled: true

# Allow ExternalName services and cross-namespace references
providers:
  kubernetesIngress:
    allowExternalNameServices: true
  kubernetesCRD:
    allowExternalNameServices: true
    allowCrossNamespace: true
